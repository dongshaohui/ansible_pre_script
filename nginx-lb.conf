upstream apiserver {
    server 10.253.2.27:8081;
    server 10.253.7.86:8081;
}

upstream umsserver {
    server 10.253.2.27:8084;
    server 10.253.7.86:8084;
}

upstream adminserver {
    server 10.139.106.76:8080;
}

upstream frontserver{
    server 10.139.105.119:8080;
    server 10.139.103.165:8080;
}

upstream withdrawserver {
    server 10.253.1.140:8085;
}
upstream cpwithdrawserver {
    server 10.253.1.140:8085;
}

upstream wechatStatic {
    server 10.253.18.46:8080;
}

upstream wechatServer {
    server 10.253.18.46:8080;
}

upstream cmspublisher {
    server 10.253.16.143:9090;
    #server 10.253.16.62:9090;
}

upstream cmsauthor {
    server 10.139.110.69:9090;
}

server {
    listen       80;
    server_name  pre.quboqu.com;
    error_page 503 /503.html;    
    
#	location ~/ {
#		rewrite ^/(.*)$ /index.html permanent;
#	}

    location /ums {
        expires -1;
        proxy_pass   http://umsserver;
    }

    location /static {
        proxy_pass http://cmspublisher/static;
    }

    location /author {
        proxy_pass http://cmsauthor/author;
    }

    location /admin/ums/ {
        expires -1;
        proxy_pass   http://umsserver/ums/;
    }

    location /admin/ {
        proxy_pass   http://adminserver/admin/;
    }

    location /wechat/ {
        proxy_pass   http://wechatStatic/wechat/;
    }

    location /WeChatServer/ {
        proxy_pass   http://WeChatServer/WeChatServer/;
    }

    #location /admin/yeepay/withdraw {
    #    proxy_pass   http://withdrawserver/yeepay/withdraw;
    #}
    location /admin/payment/withdraw {
        proxy_pass   http://cpwithdrawserver/payment/withdraw;
    }

    location /admin/api/ {
        expires -1;
        proxy_set_header Host $host:$server_port;
	proxy_set_header X-Forwarded-Proto "https";
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass   http://apiserver/api/;
    }

    location /api/ {
        expires -1;
        proxy_set_header Host $host:$server_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://apiserver/api/;
    }

    location /yeepay/deposits-notify {
        proxy_pass   http://yeepay.deposit.notify/yeepay/deposits-notify;
    }

    location /page-dep/ {
        proxy_cache my-cache;
        proxy_cache_valid 200 302 30m;
        proxy_cache_valid 404 1m;

        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://frontserver/page-dep/;
    }
    location /js/ {
        proxy_cache my-cache;
        proxy_cache_valid 200 302 30m;
        proxy_cache_valid 404 1m;

        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://frontserver/js/;
    }
    location /images/ {
        proxy_cache my-cache;
        proxy_cache_valid 200 302 30m;
        proxy_cache_valid 404 1m;

        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://frontserver/images/;
    }
    location /fonts/ {
        proxy_cache my-cache;
        proxy_cache_valid 200 302 30m;
        proxy_cache_valid 404 1m;

        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://frontserver/fonts/;
    }
    location /css/ {
        proxy_cache my-cache;
        proxy_cache_valid 200 302 30m;
        proxy_cache_valid 404 1m;

        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://frontserver/css/;
    }

    ## front server
    location / {
		#rewrite ^/(.*)$ /js/templates/index.html last;
        add_header X-Frame-Options SAMEORIGIN;
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://frontserver;
    }
}


server {
    listen       80;
    server_name  wechatpre.jia16.com;
    location /ums {
        expires -1;
        proxy_pass   http://umsserver;
    }
    location /api/ {
        expires -1;
        proxy_set_header Host $host:$server_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto "https";
        proxy_pass   http://apiserver/api/;
    }
    location /wechat/ {
        proxy_pass   http://wechatServer/wechat/;
    }

    location /WeChatServer/ {
        proxy_pass   http://wechatServer/WeChatServer/;
    }

}



server {
    listen       81;
    server_name  pre.quboqu.com;
    

    location / {
	return 301 https://pre.quboqu.com;
    }
}
